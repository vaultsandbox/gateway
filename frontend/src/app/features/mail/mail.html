<div class="resize-container-8 h-screen flex relative lg:static bg-surface-50 dark:bg-surface-950">
  <div
    id="app-vs-sidebar"
    class="bg-surface-0 dark:bg-surface-900 h-screen hidden lg:block shrink-0 absolute lg:static left-0 top-0 z-10 border-r border-surface-200 dark:border-surface-700 select-none w-[340px]"
  >
    <app-mailbox-sidebar
      (openInboxWebhooks)="openInboxWebhooksDialog($event)"
      (openInboxChaos)="openInboxChaosDialog($event)"
    ></app-mailbox-sidebar>
  </div>
  <div class="flex flex-col relative flex-auto min-h-0">
    <div
      class="flex justify-between items-center py-4 px-4 sm:px-8 bg-surface-0 dark:bg-surface-900 border-b border-surface-200 dark:border-surface-700 relative lg:static shrink-0"
    >
      <div class="flex items-center gap-4 min-w-0 flex-1 overflow-hidden">
        <a
          pStyleClass="#app-vs-sidebar"
          enterFromClass="hidden"
          enterActiveClass="animate-fadeinleft"
          leaveToClass="hidden"
          leaveActiveClass="animate-fadeoutleft"
          [hideOnOutsideClick]="true"
          [hideOnResize]="true"
          resizeSelector=".resize-container-8"
          class="cursor-pointer flex items-center justify-center lg:hidden text-surface-700 dark:text-surface-100"
        >
          <i class="pi pi-bars text-xl!"></i>
        </a>
        @if (selectedInbox()) {
          <div class="flex items-center gap-2 min-w-0">
            <div class="flex flex-col min-w-0">
              <span
                class="truncate max-w-[200px] sm:max-w-[260px] md:max-w-none cursor-pointer hover:text-primary transition-colors relative overflow-hidden rounded px-1 -mx-1"
                tabindex="0"
                role="button"
                (click)="copyToClipboard(selectedInbox()!.emailAddress)"
                (keydown.enter)="copyToClipboard(selectedInbox()!.emailAddress)"
                (keydown.space)="copyToClipboard(selectedInbox()!.emailAddress)"
                pRipple
              >
                {{ selectedInbox()!.emailAddress }}
              </span>
              <span
                class="text-xs text-surface-500 dark:text-surface-400 truncate max-w-[200px] sm:max-w-[260px] md:max-w-none"
              >
                Expires: {{ selectedInbox()!.expiresAt | date: dateFormat() }}
              </span>
            </div>
            <!-- Desktop buttons -->
            <div class="hidden sm:flex items-center gap-1">
              <button
                pButton
                [text]="true"
                [rounded]="true"
                severity="secondary"
                size="small"
                (click)="handleRefresh()"
                pRipple
                pTooltip="Refresh emails"
                tooltipPosition="bottom"
                class="action-ripple"
              >
                <i pButtonIcon class="pi pi-refresh"></i>
              </button>
              @if (webhookEnabled()) {
                <button
                  pButton
                  [text]="true"
                  [rounded]="true"
                  severity="secondary"
                  size="small"
                  (click)="openSelectedInboxWebhooks()"
                  pRipple
                  pTooltip="Webhooks"
                  tooltipPosition="bottom"
                  class="action-ripple"
                >
                  <i pButtonIcon class="pi pi-bolt"></i>
                </button>
              }
              @if (chaosEnabled()) {
                <button
                  pButton
                  [text]="true"
                  [rounded]="true"
                  [severity]="selectedInboxChaosEnabled() ? 'danger' : 'secondary'"
                  size="small"
                  (click)="openSelectedInboxChaos()"
                  pRipple
                  pTooltip="Chaos"
                  tooltipPosition="bottom"
                  class="action-ripple"
                >
                  <i pButtonIcon class="pi pi-exclamation-triangle"></i>
                </button>
              }
            </div>
            <!-- Mobile menu button -->
            <button
              pButton
              [text]="true"
              [rounded]="true"
              [severity]="selectedInboxChaosEnabled() ? 'danger' : 'secondary'"
              size="small"
              (click)="mobileMenu.toggle($event)"
              class="sm:hidden action-ripple"
            >
              <i pButtonIcon class="pi pi-chevron-down"></i>
            </button>
            <p-menu #mobileMenu [popup]="true" [model]="mobileMenuItems()" appendTo="body"></p-menu>
          </div>
        } @else {
          <div class="text-surface-400">No inbox selected</div>
        }
      </div>
      <div class="flex items-center gap-8">
        <div>
          <button pButton [text]="true" [rounded]="true" severity="secondary" (click)="menu.toggle($event)">
            <i pButtonIcon class="pi pi-ellipsis-v"></i>
          </button>
          <p-menu #menu [popup]="true" [model]="topLeftMenuitems()" appendTo="body"></p-menu>
        </div>
      </div>
    </div>
    <div class="px-4 sm:px-8 py-8 flex flex-col flex-auto overflow-y-auto min-h-0">
      @if (selectedInbox()) {
        @if (viewMode() === 'list') {
          <app-email-list
            [emails]="selectedInbox()!.emails"
            [inboxHash]="selectedInbox()!.inboxHash"
            [emailAddress]="selectedInbox()!.emailAddress"
            (emailSelected)="handleEmailSelected($event)"
          ></app-email-list>
        } @else {
          <app-email-detail [email]="selectedEmail()" (backToList)="handleBackToList()"></app-email-detail>
        }
      } @else {
        <div class="flex items-center justify-center h-full text-surface-400">
          No inbox selected. Create or select an inbox to view emails.
        </div>
      }
    </div>
  </div>

  <!-- Settings Dialog -->
  @if (showSettingsDialog()) {
    <app-settings-dialog (closed)="showSettingsDialog.set(false)"></app-settings-dialog>
  }

  <!-- Metrics Dialog -->
  @if (showMetricsDialog()) {
    <app-metrics-dialog (closed)="showMetricsDialog.set(false)"></app-metrics-dialog>
  }

  <!-- Console Dialogs -->
  @for (consoleId of openConsoleDialogs(); track consoleId) {
    <app-sse-console-dialog (closed)="closeConsoleDialog(consoleId)"></app-sse-console-dialog>
  }

  <!-- Webhooks Dialog -->
  @if (showWebhooksDialog()) {
    <app-webhook-list-dialog
      [scope]="webhookScope()"
      (closed)="showWebhooksDialog.set(false)"
    ></app-webhook-list-dialog>
  }

  <!-- Chaos Configuration Dialog -->
  @if (showChaosDialog() && chaosInbox()) {
    <app-chaos-config-dialog
      [inbox]="chaosInbox()!"
      (closed)="onChaosDialogClosed()"
      (statusChanged)="onChaosStatusChanged($event)"
    ></app-chaos-config-dialog>
  }
</div>
