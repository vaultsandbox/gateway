<div class="p-4 space-y-4">
  @if (!spamAnalysis) {
    <div class="text-center py-8 text-surface-400">
      <i class="pi pi-info-circle text-3xl mb-3 block"></i>
      <p>Spam analysis not available for this email</p>
    </div>
  } @else if (spamAnalysis.status === 'skipped') {
    <div class="text-center py-8 text-surface-400">
      <i class="pi pi-minus-circle text-3xl mb-3 block"></i>
      <p>Spam analysis skipped</p>
      @if (spamAnalysis.info) {
        <p class="text-sm mt-2">{{ spamAnalysis.info }}</p>
      }
    </div>
  } @else if (spamAnalysis.status === 'error') {
    <div class="text-center py-8 text-yellow-600 dark:text-yellow-400">
      <i class="pi pi-exclamation-triangle text-3xl mb-3 block"></i>
      <p>Spam analysis failed</p>
      @if (spamAnalysis.info) {
        <p class="text-sm mt-2 text-surface-500">{{ spamAnalysis.info }}</p>
      }
      @if (spamAnalysis.processingTimeMs) {
        <p class="text-xs mt-1 text-surface-400">Timeout after {{ spamAnalysis.processingTimeMs }}ms</p>
      }
    </div>
  } @else {
    <!-- Score Overview Card -->
    <p-card>
      <ng-template pTemplate="header">
        <div class="px-4 pt-4 pb-2 flex items-center justify-between">
          <div class="flex items-center gap-2">
            <i class="pi pi-chart-bar text-lg"></i>
            <span class="font-semibold">Spam Score</span>
          </div>
          <span class="px-3 py-1 rounded text-sm font-semibold" [ngClass]="getActionClass(spamAnalysis.action)">
            {{ formatAction(spamAnalysis.action) }}
          </span>
        </div>
      </ng-template>
      <div class="space-y-4">
        <!-- Score Display -->
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <span class="text-4xl font-bold" [ngClass]="getScoreClass(spamAnalysis.score, spamAnalysis.requiredScore)">
              {{ spamAnalysis.score?.toFixed(1) ?? 'N/A' }}
            </span>
            <div class="text-sm text-surface-500">
              <span>/ {{ spamAnalysis.requiredScore?.toFixed(1) ?? '6.0' }} threshold</span>
            </div>
          </div>
          <div class="text-right">
            <span class="text-lg font-semibold" [ngClass]="getVerdict().class">
              {{ getVerdict().text }}
            </span>
          </div>
        </div>

        <!-- Score Bar -->
        <div class="relative h-3 bg-surface-200 dark:bg-surface-700 rounded-full overflow-hidden">
          @if (spamAnalysis.score !== undefined && spamAnalysis.requiredScore !== undefined) {
            <!-- Threshold marker -->
            <div
              class="absolute top-0 bottom-0 w-0.5 bg-surface-500 dark:bg-surface-400 z-10"
              [style.left.%]="(spamAnalysis.requiredScore / 15) * 100"
            ></div>
            <!-- Score fill -->
            <div
              class="absolute top-0 left-0 bottom-0 rounded-full transition-all"
              [ngClass]="{
                'bg-green-500': spamAnalysis.score < 3,
                'bg-yellow-500': spamAnalysis.score >= 3 && spamAnalysis.score < spamAnalysis.requiredScore,
                'bg-red-500': spamAnalysis.score >= spamAnalysis.requiredScore,
              }"
              [style.width.%]="Math.min(Math.max((spamAnalysis.score / 15) * 100, 0), 100)"
            ></div>
          }
        </div>

        @if (spamAnalysis.processingTimeMs) {
          <div class="text-xs text-surface-400 text-right">Analyzed in {{ spamAnalysis.processingTimeMs }}ms</div>
        }
      </div>
    </p-card>

    <!-- Symbols Section -->
    @if (spamAnalysis.symbols && spamAnalysis.symbols.length > 0) {
      <!-- Spam Indicators (Positive scores) -->
      @if (categorizeSymbols().positive.length > 0) {
        <p-card>
          <ng-template pTemplate="header">
            <div class="px-4 pt-4 pb-2 flex items-center gap-2">
              <i class="pi pi-exclamation-circle text-lg text-red-500"></i>
              <span class="font-semibold">Spam Indicators</span>
              <span class="text-xs bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 px-2 py-0.5 rounded">
                {{ categorizeSymbols().positive.length }}
              </span>
            </div>
          </ng-template>
          <div class="space-y-2">
            @for (symbol of categorizeSymbols().positive; track symbol.name) {
              <div
                class="flex items-start justify-between p-2 rounded border border-surface-200 dark:border-surface-700"
              >
                <div class="flex-1 min-w-0">
                  <div class="font-mono text-sm font-semibold text-surface-900 dark:text-surface-100">
                    {{ symbol.name }}
                  </div>
                  @if (symbol.description) {
                    <div class="text-xs text-surface-500 mt-0.5">{{ symbol.description }}</div>
                  }
                  @if (symbol.options && symbol.options.length > 0) {
                    <div class="text-xs text-surface-400 mt-1 font-mono truncate">
                      {{ symbol.options.join(', ') }}
                    </div>
                  }
                </div>
                <span class="font-mono text-sm font-semibold ml-2" [ngClass]="getSymbolScoreClass(symbol.score)">
                  {{ formatScore(symbol.score) }}
                </span>
              </div>
            }
          </div>
        </p-card>
      }

      <!-- Ham Indicators (Negative scores) -->
      @if (categorizeSymbols().negative.length > 0) {
        <p-card>
          <ng-template pTemplate="header">
            <div class="px-4 pt-4 pb-2 flex items-center gap-2">
              <i class="pi pi-check-circle text-lg text-green-500"></i>
              <span class="font-semibold">Legitimacy Indicators</span>
              <span
                class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-0.5 rounded"
              >
                {{ categorizeSymbols().negative.length }}
              </span>
            </div>
          </ng-template>
          <div class="space-y-2">
            @for (symbol of categorizeSymbols().negative; track symbol.name) {
              <div
                class="flex items-start justify-between p-2 rounded border border-surface-200 dark:border-surface-700"
              >
                <div class="flex-1 min-w-0">
                  <div class="font-mono text-sm font-semibold text-surface-900 dark:text-surface-100">
                    {{ symbol.name }}
                  </div>
                  @if (symbol.description) {
                    <div class="text-xs text-surface-500 mt-0.5">{{ symbol.description }}</div>
                  }
                  @if (symbol.options && symbol.options.length > 0) {
                    <div class="text-xs text-surface-400 mt-1 font-mono truncate">
                      {{ symbol.options.join(', ') }}
                    </div>
                  }
                </div>
                <span class="font-mono text-sm font-semibold ml-2" [ngClass]="getSymbolScoreClass(symbol.score)">
                  {{ formatScore(symbol.score) }}
                </span>
              </div>
            }
          </div>
        </p-card>
      }

      <!-- Informational (Neutral scores) -->
      @if (categorizeSymbols().neutral.length > 0) {
        <p-card>
          <ng-template pTemplate="header">
            <div class="px-4 pt-4 pb-2 flex items-center gap-2">
              <i class="pi pi-info-circle text-lg text-surface-500"></i>
              <span class="font-semibold">Informational</span>
              <span
                class="text-xs bg-surface-200 dark:bg-surface-700 text-surface-700 dark:text-surface-300 px-2 py-0.5 rounded"
              >
                {{ categorizeSymbols().neutral.length }}
              </span>
            </div>
          </ng-template>
          <div class="space-y-2">
            @for (symbol of categorizeSymbols().neutral; track symbol.name) {
              <div
                class="flex items-start justify-between p-2 rounded border border-surface-200 dark:border-surface-700"
              >
                <div class="flex-1 min-w-0">
                  <div class="font-mono text-sm font-semibold text-surface-900 dark:text-surface-100">
                    {{ symbol.name }}
                  </div>
                  @if (symbol.description) {
                    <div class="text-xs text-surface-500 mt-0.5">{{ symbol.description }}</div>
                  }
                  @if (symbol.options && symbol.options.length > 0) {
                    <div class="text-xs text-surface-400 mt-1 font-mono truncate">
                      {{ symbol.options.join(', ') }}
                    </div>
                  }
                </div>
                <span class="font-mono text-sm font-semibold ml-2 text-surface-500"> 0.00 </span>
              </div>
            }
          </div>
        </p-card>
      }
    }
  }
</div>
